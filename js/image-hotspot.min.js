(function(c){var d=c.extend({},window.imageEdit);var a=false;var b=window.hotspot={open:function(e){var f=window.hotspot;c(document).off("click",f.btnClass);f.btnClass=".imgedit-hotspot";f.hotspotClass=".hotspot";f.hotspotActiveClass="hotspot-active";f.hotspotDisabledClass="hotspot-disabled";c.post(imagehotspot.ajax_url,{action:"get-attachment",id:e},function(g){if(g.success){f.attachment=g.data}else{}},"json");return d.open.apply(this,arguments)},close:function(){var e=window.hotspot;e.hotspotRemoveListener();c(document).off("click",e.btnClass);d.close.apply(this,arguments)},save:function(f){var e=window.hotspot;if(e.hotspotActive){this.toggleEditor(f,1);c.post(imagehotspot.ajax_url,{action:"hotspot_save",hotspot_nonce:imagehotspot.hotspot_nonce,attachment_id:e.attach_id,hotspots:[e.hotspot]},function(g){if(g.success){c("#imgedit-response-"+f).html('<div class="updated"><p>'+g.data.msg+"</p></div>");if(window.imageEdit._view){e.hotspotRemoveListener();c(document).off("click",e.btnClass);window.imageEdit._view.save()}else{window.imageEdit.close(f)}}else{c("#imgedit-response-"+f).html('<div class="error"><p>'+g.data.msg+"</p></div>");window.imageEdit.close(f);return}},"json")}else{if(""!==this.filterHistory(f,0)){c.post(imagehotspot.ajax_url,{action:"hotspot_delete",hotspot_nonce:imagehotspot.hotspot_nonce,attachment_id:e.attach_id,})}d.save.apply(this,arguments)}},imgLoaded:function(g){var f=window.hotspot;f.$image=c("#image-preview-"+g);f.$parent=c("#imgedit-crop-"+g);f.attach_id=g;d.imgLoaded.apply(this,arguments);c(".imgedit-menu button:last").after('<button class="button '+f.btnClass.substr(1)+'" title="'+imagehotspot.btn_title+'"></button>');c(".imgedit-menu button").not(f.btnClass).each(function(){var h=this.onclick;this.onclick=null;c(this).on("click",function(i){if(c(this).hasClass(f.hotspotDisabledClass)){i.stopImmediatePropagation();return false}else{h.apply(this,arguments)}})});if(imagehotspot.pointer){var e=c.extend(imagehotspot.pointer,{close:function(){c.post(imagehotspot.ajax_url,{pointer:imagehotspot.pointer_id,action:"dismiss-wp-pointer"});a=true}});setTimeout(function(){if(!a){c(f.btnClass).first().pointer(e).pointer("open");c(f.btnClass).first().pointer("instance").pointer.css({zIndex:170000})}},50)}c(document).on("click",f.btnClass,f.hotspotToggleActivation)},refreshEditor:function(){var e=window.hotspot;e.hotspotRemoveListener();c(e.btnClass).addClass(e.hotspotDisabledClass);c(document).off("click",e.btnClass);d.refreshEditor.apply(this,arguments)},hotspotAddListener:function(){var e=window.hotspot;e.$image.on("click.hotspot",e.hotspotClick);e.$image.css("cursor","crosshair");e.$image.imgAreaSelect({remove:true});c(".imgedit-menu button").not(e.btnClass).addClass(e.hotspotDisabledClass);window.imageEdit.setDisabled=function(){return false}},hotspotRemoveListener:function(){var e=window.hotspot;e.hotspotRemove();e.$image.off("click.hotspot");e.$image.css("cursor","default");d.initCrop(e.attach_id,e.$image,e.$image.parent());c(".imgedit-menu button").not(e.btnClass).removeClass(e.hotspotDisabledClass);c(".imgedit-submit-btn").prop("disabled",true);window.imageEdit.setDisabled=d.setDisabled},hotspotToggleActivation:function(){var e=window.hotspot,f=c(this);if(c(this).hasClass(e.hotspotActiveClass)){e.hotspotRemoveListener();f.removeClass(e.hotspotActiveClass);e.hotspotActive=false}else{e.hotspotAddListener();f.addClass(e.hotspotActiveClass);e.correction=e.attachment.width/e.$image.width();if(e.attachment.hotspot&&e.attachment.hotspot!==""){c.each(e.attachment.hotspot,function(g,h){e.hotspotAdd({x:h.x/e.correction,y:h.y/e.correction,})})}}return false},hotspotAdd:function(g){var f=window.hotspot,e=40;g=c.extend({x:0,y:0,},g);f.hotspotActive=true;c(".imgedit-submit-btn").removeAttr("disabled");c('<div class="'+f.hotspotClass.substr(1)+'"></div>').css({left:g.x-(e/2),top:g.y-(e/2),width:e+"px",height:e+"px",position:"absolute"}).attr("title","Click to toggle on/off").appendTo(f.$parent).click(function(){f.hotspotRemove()});f.hotspot={x:Math.round(g.x*f.correction),y:Math.round(g.y*f.correction)}},hotspotRemove:function(){var e=window.hotspot;e.hotspotActive=false;e.hotspot={};c(e.hotspotClass).remove();c(".imgedit-submit-btn").prop("disabled",true)},hotspotClick:function(g){var f=window.hotspot;f.hotspotRemove();f.hotspotAdd({x:g.offsetX||g.clientX-(c(g.target).offset().left-window.scrollX),y:g.offsetY||g.clientY-(c(g.target).offset().top-window.scrollY)})}};window.imageEdit=c.extend(window.imageEdit,b)})(jQuery);